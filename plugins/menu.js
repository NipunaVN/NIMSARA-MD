const { cmd, commands } = require("../command");
const config = require('../config');

cmd(
  {
    pattern: "menu",
    alias: ["getmenu"],
    react: "üíØ",  // Default react to show for this command
    desc: "get cmd list",
    category: "main",
    filename: __filename,
  },
  async (
    robin,
    mek,
    m,
    {
      from,
      quoted,
      body,
      isCmd,
      command,
      args,
      q,
      isGroup,
      sender,
      senderNumber,
      botNumber2,
      botNumber,
      pushname,
      isMe,
      isOwner,
      groupMetadata,
      groupName,
      participants,
      groupAdmins,
      isBotAdmins,
      isAdmins,
      reply,
    }
  ) => {
    try {
      let menu = {
        main: "",
        download: "",
        group: "",
        owner: "",
        convert: "",
        search: "",
      };

      // Loop through all commands and construct the menu
      for (let cmd of commands) {
        if (cmd.pattern && !cmd.dontAddCommandList && menu[cmd.category] !== undefined) {
          menu[cmd.category] += `${config.PREFIX}${cmd.pattern}\n`;
        }
      }

      let madeMenu = `üëã‚ú® *Hello...üç∑  ${pushname || "User"}*\n\n` +
        `| *MAIN COMMANDS* |\n` +
        `    ‚û• .alive\n` +
        `    ‚û• .menu\n` +
        `    ‚û• .owner\n` +
        `| *DOWNLOAD COMMANDS* |\n` +
        `    ‚û• .song <text>\n` +
        `    ‚û• .video <text>\n` +
        `    ‚û• .fb <link>\n` +
        `| *GROUP COMMANDS* |\n` +
        `    ‚û• .demote \n` +
        `    ‚û• .promote \n` +
        `    ‚û• .mute \n` +
        `    ‚û• .unmute \n` +
        `    ‚û• .kick \n` +
        `    ‚û• .add \n` +
        `| *OWNER COMMANDS* |\n` +
        `    ‚û• .restart\n` +
        `    ‚û• .update\n` +
        `    ‚û• .block \n` +
        `    ‚û• .unblock \n` +
        `| *CONVERT COMMANDS* |\n` +
        `    ‚û• .sticker <reply img>\n` +
        `    ‚û• .img <reply sticker>\n` +
        `| *SEARCH COMMANDS* |\n` +
        `${menu.search || "    ‚û• No search commands available\n"}\n\n` +
        `üö´ Made By ùêç_ùêà_ùêå_ùêí_ùêÄ_ùêë_ùêÄ üö´\n\n` +
        `> NIMSARA MENU MSG`;

      // Send presence update
      await robin.sendPresenceUpdate('recording', from);

      // Send audio message (optional)
      await robin.sendMessage(from, {
        audio: {
          url: "https://github.com/nimsara-md64/Bot-helper/raw/refs/heads/main/audio/Bot%20auto%20voice%20.mp3"
        },
        mimetype: 'audio/mpeg',
        ptt: true
      }, { quoted: mek });

      // Send image with the menu
      await robin.sendMessage(from, {
        image: {
          url: "https://raw.githubusercontent.com/nimsara-md64/Bot-helper/refs/heads/main/Menu.jpg"
        },
        caption: madeMenu
      }, { quoted: mek });

      // React to the message with the specified emoji
      const reaction = cmd.react || "üíØ";  // Use the default reaction or the one defined for the command
      await robin.react(from, reaction);  // React to the message

    } catch (e) {
      console.error("Error in menu command:", e);
      await reply(`‚ùå Error generating menu: ${e.message}`);
    }
  }
);
